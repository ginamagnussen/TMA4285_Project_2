---
title: "TMA4285 Time series models"
subtitle: "Exercise 8: Comparison of a state space model and a SARIMA model"
author: "Sivert Selnes, Kristine L. Mathisen, Gina Magnussen"
date: "20th of October 2018"
output: 
  pdf_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
# Libraries
library(astsa)
library(forecast)
# libraries for state-space: dse, dlm, KFAS
```

#### Remember:

* Note how uncertainty should be written: 0.056(7) (See sources on web page)

# Structure
## Title
## Abstract 
## Introduction
## Theory
```{r, child='theory.Rmd'}

```

---------------------------------------------------------

## Data analysis

## 1. Exploring the data with plotting of relevant statistics
The data set consists of total number of international airline passengers for each month from January 1949 to December 1960(reference to data set), giving a total number of $N=144$ observations.
```{r, echo = FALSE}
dataseries <- ts(read.table("dataEx8.txt"), frequency = 12)
par(mfrow=c(1,2))
acf(dataseries, lag.max = 50)
pacf(dataseries, lag.max = 50)
```

From the time series plot, this is obviously a non-stationary series as both trend and seasonality is visible in the visualization. Trend is there because the total number of airline passengers on average increases for each month, and seasonality because of the wave-like behaviour of the series. Non-stationarity is further supported by looking at the autocorrelation function, which shows considerable correlation between observations even up to lag $h$ of size $30$.


To investigate the data, we first find a transformation to the time series. A normal transformation is the $\log()$-transformation. This transformation seems to stabilize the multiplicative behaviour of the variance so that the variance is not increasing with time.
Secondly, the data is differenced to remove trend. As there after differencing once still seems to be a pattern for a season equal to the length of a year, i.e. $s = 12$ in a seasonal ARIMA model, a twelfth-order difference is applied. The result is seen in Figure ?.

```{r, echo = FALSE}
log_series <- log(dataseries)
diff_series <- diff(log_series)
diff12_series <- diff(diff_series, lag = 12)
plot.ts(cbind(log_series, diff_series, diff12_series), main="Transformed and differenced data")
ggtsdisplay(diff12_series)
```
The obtained series after applying the twelfth-order difference seems to be stationary, and models can then be applied. (Show that it is stationary?)



Consider now the ACF and the PACF of the last differenced series.
```{r, echo=FALSE}
acf2(diff12_series, max.lag = 50)
```
Both the ACF and the PACF seems to be tailing off after lags greater than one season, i.e. $1s$ where $s=12$.

Next: Use ACF and PACF to justify choice of model parameters.





## 2. Justification of the choice of model
### Trying to fit models:

State-space model
```{r, echo=FALSE}
# ap <- log10(AirPassengers) - 2
state_space <- StructTS(dataseries, type = "BSM") # Basic structural model
state_space_log <- StructTS(log_series, type ="BSM")
par(mfrow = c(1, 2))
plot(cbind(dataseries, fitted(state_space)), plot.type = "single") # From AirPassengers example
plot(cbind(dataseries, tsSmooth(state_space)), plot.type = "single")
plot(forecast(state_space_log, h = 50)) 
```

## 3. Model parameter estimation including uncertainty 
<!-- Simulation -->
## 4. Model prediction at the given sample points and for the next year including uncertainty of the best linear predictions
<!-- Forecasting -->
## 5. Diagnostics, and model choice discussion including comparison of the two models


-------------------------------------------


## Discussion
## Conclusion
## Appendix
## References

